<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>计算题生成器</title>
  <style>
    /* 样式可以在这里添加 */
    .correct {
      color: green;
    }
    .incorrect {
      color: red;
    }
    .hidden-label {
      display: none;
    }
  </style>
</head>
<body>
  <h1>计算题生成器</h1>
  <label for="minRange">最小范围：</label>
  <input type="number" id="minRange" value="1">
  <br>
  <label for="maxRange">最大范围：</label>
  <input type="number" id="maxRange" value="10" oninput="checkMaxValue2(this)">
  <input type="checkbox" id="jgfw">
  <label for="jgfw">结果在此范围内</label>
  <br>
  <label for="numOfValues">数值数量：</label>
  <input type="number" id="numOfValues" value="2" oninput="checkMaxValue(this)">
  <br>
  <label for="numOfQuestions">出题数量：</label>
  <input type="number" id="numOfQuestions" value="5" oninput="checkMaxValue1(this)">
  <br>
  <input type="checkbox" id="addition" name="ysf" onclick="checkysf()">
  <label for="addition">加法</label>
  <input type="checkbox" id="subtraction" name="ysf" onclick="checkysf()">
  <label for="subtraction">减法</label>
  <input type="checkbox" id="multiplication" name="ysf" onclick="checkysf()">
  <label for="multiplication">乘法</label>
  <input type="checkbox" id="division" name="ysf" onclick="checkysf();seebaoliu()">
  <label for="division">除法</label>
  <label id="baoliu" class="hidden-label">保留三位小数</label>
  <br>
  <button id="creat" disabled onclick="generateQuestions()">生成题目</button>
  <div id="questions"></div>
  <button id = "answerbutton" disabled onclick="checkAnswers()">提交答案</button>

  <script>
    
    function generateQuestions() {
      // 获取输入的值
      var minRange = parseInt(document.getElementById('minRange').value);
      var maxRange = parseInt(document.getElementById('maxRange').value);
      var numOfValues = parseInt(document.getElementById('numOfValues').value);
      var numOfQuestions = parseInt(document.getElementById('numOfQuestions').value);
      var includeAddition = document.getElementById('addition').checked;
      var includeSubtraction = document.getElementById('subtraction').checked;
      var includeMultiplication = document.getElementById('multiplication').checked;
      var includeDivision = document.getElementById('division').checked;
      
      var questionsDiv = document.getElementById('questions');
      questionsDiv.innerHTML = ''; // 清空之前的题目

      // 生成题目
      for (var i = 0; i < numOfQuestions; i++) {
        var question = generateQuestion(minRange,maxRange,numOfValues, includeAddition, includeSubtraction, includeMultiplication, includeDivision);
        var questionParagraph = document.createElement('p');
        
        questionParagraph.textContent = question;

        // 创建输入框
        var answerInput = document.createElement('input');
        answerInput.type = 'number';
        answerInput.placeholder = '输入答案';
        questionParagraph.appendChild(document.createTextNode(' = '));
        questionParagraph.appendChild(answerInput);
        answerInput.style.width = '80px';

        questionsDiv.appendChild(questionParagraph);
      }
      answerbutton.disabled = false;
    }

    function checkAnswers() {
      var inputs = document.querySelectorAll('#questions input[type="number"]');
      var allAnswered = true;

      // 检查是否所有的答案都已填写
      inputs.forEach(function(input) {
        if (!input.value) {
          allAnswered = false;
          return;
        }
      });

      // 提示用户有未填写的答案
      if (!allAnswered) {
        var confirmSubmit = confirm('有未填写的答案，确定要提交吗？');
        if (!confirmSubmit) {
          return;
        }
      }

      var submitButton = document.querySelector('button[onclick="checkAnswers()"]');
      submitButton.disabled = true;

      

    inputs.forEach(function(input) {
        var userAnswer = input.value.trim(); // 获取用户输入的答案
        var question = input.parentElement.textContent.split('=')[0].trim();
        var correctAnswer = calculateAnswer(question);
        var answerDisplay = document.createElement('span');


  // 检查用户答案是否为整数或浮点数，最多保留两位小数
        if (!isNaN(userAnswer) && userAnswer !== '') {
          userAnswer = parseFloat(userAnswer); // 将用户答案转换为浮点数
          userAnswer = userAnswer.toFixed(3); // 保留两位小数
          userAnswer = userAnswer % 1 === 0 ? parseInt(userAnswer) : parseFloat(userAnswer); // 转换为整数或浮点数
        
        }
        correctAnswer = parseFloat(correctAnswer); // 将用户答案转换为浮点数
        correctAnswer = correctAnswer.toFixed(3); // 保留两位小数
        correctAnswer = correctAnswer % 1 === 0 ? parseInt(correctAnswer) : parseFloat(correctAnswer); // 转换为整数或浮点数
        answerDisplay.textContent = ' (答案: ' + correctAnswer + ')';
        if (userAnswer === correctAnswer) {
          answerDisplay.classList.add('correct');
          answerDisplay.textContent += ' - 正确✅';
        } else {
          answerDisplay.classList.add('incorrect');
          answerDisplay.textContent += ' - 错误❎';
        }

        input.parentElement.appendChild(answerDisplay);
      
    });
    
  }

    function generateQuestion(min, max, values, add, sub, mult, div) {
      var operators = [];
      // console.log(add,sub,mult,div);
      if (add) operators.push('+');
      if (sub) operators.push('-');
      if (mult) operators.push('*');
      if (div) operators.push('/');
      
      var nums = [];
      for (var i = min; i <= max; i++) {
        nums.push(i);
      }
        // console.log(nums) ;
        
    
      
      var question = '';
     
      var fwxz = document.getElementById('jgfw').checked;
                
      if (fwxz) {
        var withinRange = false;
        

        while (!withinRange) {
          question = ''; // 重新生成 question
          for (var i = 0; i < values; i++) {
            if (i > 0) {
            var op = operators[Math.floor(Math.random() * operators.length)];
            question += ' ' + op + ' ';
            }
          var randomNum = nums[Math.floor(Math.random() * nums.length)];
          question += randomNum;
          console.log(question);
          }
      
        var result = calculateAnswer(question);
    
      // 检查结果是否在 min 和 max 范围内
          if (result >= min && result <= max) {
            withinRange = true;
          }
        }
      } else {
          for (var i = 0; i < values; i++) {
            if (i > 0) {
            var op = operators[Math.floor(Math.random() * operators.length)];
            question += ' ' + op + ' ';
            }
          var randomNum = nums[Math.floor(Math.random() * nums.length)];
          question += randomNum;
          console.log(question);
          }
        }

      return question;






    }


    

    function calculateAnswer(question) {
      return eval(question);
    }

    function checkysf(){
        var checkBoxes = document.getElementsByName("ysf");
        var button = document.getElementById("creat");
        var checkedCount = 0;
        for (var i = 0; i < checkBoxes.length; i++) {
            if (checkBoxes[i].checked == true) {
                checkedCount++;
            }
        }
        if (checkedCount == 0) {
            button.disabled = true;
        } else {
            button.disabled = false;
            }
    }

    function seebaoliu(){
        var label1 =  document.getElementById("baoliu");
        var checkbox4 =document.getElementById("division");
        if (checkbox4.checked == true) {
            label1.classList.remove('hidden-label')
        }else{
            label1.classList.add('hidden-label')
        }
    }

    function checkMaxValue(input) {
        if (input.value > 10) {
            input.value = 10;
        }
        if (input.value < 2) {
            input.value = 2;
        }
    }
    function checkMaxValue1(input) {
        if (input.value > 100) {
            input.value = 100;
        }
        if (input.value < 1) {
            input.value = 1;
        }
    }
    function checkMaxValue2(input) {
        if (input.value > 1000) {
            input.value = 1000;
        }
        if (input.value < 1) {
            input.value = 1;
        }
    }
    
  </script>
</body>
</html>
